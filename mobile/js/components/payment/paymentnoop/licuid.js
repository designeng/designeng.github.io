define(["http://d3js.org/d3.v3.min.js"],function(e){function t(){return{minValue:0,maxValue:100,circleThickness:.05,circleFillGap:.05,circleColor:"#178BCA",waveHeight:.05,waveCount:1,waveRiseTime:1e3,waveAnimateTime:18e3,waveRise:!0,waveHeightScaling:!0,waveAnimate:!0,waveColor:"#178BCA",waveOffset:0,textVertPosition:.5,textSize:1,valueCountUp:!0,displayPercent:!0,textColor:"#045681",waveTextColor:"#A4DBf8"}}function n(n,r,i){function z(){F.transition().duration(i.waveAnimateTime).ease("linear").attr("transform","translate("+M(1)+",0)").each("end",function(){F.attr("transform","translate("+M(0)+",0)"),z(i.waveAnimateTime)})}i==null&&(i=t());var s=e.select("#"+n),o=Math.min(parseInt(s.style("width")),parseInt(s.style("height")))/2,u=parseInt(s.style("width"))/2-o,a=parseInt(s.style("height"))/2-o,f=Math.max(i.minValue,Math.min(i.maxValue,r))/i.maxValue,l;i.waveHeightScaling?l=e.scale.linear().range([0,i.waveHeight,0]).domain([0,50,100]):l=e.scale.linear().range([i.waveHeight,i.waveHeight]).domain([0,100]);var c=i.textSize*o/2,h=parseFloat(r).toFixed(2),p=i.valueCountUp?i.minValue:h,d=i.displayPercent?"%":"",v=i.circleThickness*o,m=i.circleFillGap*o,g=v+m,y=o-g,b=y*l(f*100),w=y*2/i.waveCount,E=1+i.waveCount,S=w*E,x=function(e){return Math.round(e)};parseFloat(h)!=parseFloat(x(h))&&(x=function(e){return parseFloat(e).toFixed(1)}),parseFloat(h)!=parseFloat(x(h))&&(x=function(e){return parseFloat(e).toFixed(2)});var T=[];for(var N=0;N<=40*E;N++)T.push({x:N/(40*E),y:N/40});var C=e.scale.linear().range([0,2*Math.PI]).domain([0,1]),k=e.scale.linear().range([0,o]).domain([0,o]),L=e.scale.linear().range([0,S]).domain([0,1]),A=e.scale.linear().range([0,b]).domain([0,1]),O=e.scale.linear().range([g+y*2+b,g-b]).domain([0,1]),M=e.scale.linear().range([0,S-y*2]).domain([0,1]),_=e.scale.linear().range([g+y*2,g+c*.7]).domain([0,1]),D=s.append("g").attr("transform","translate("+u+","+a+")"),P=e.svg.arc().startAngle(C(0)).endAngle(C(1)).outerRadius(k(o)).innerRadius(k(o-v));D.append("path").attr("d",P).style("fill",i.circleColor).attr("transform","translate("+o+","+o+")");var H=D.append("text").text(x(p)+d).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size",c+"px").style("fill",i.textColor).attr("transform","translate("+o+","+_(i.textVertPosition)+")"),B=e.svg.area().x(function(e){return L(e.x)}).y0(function(e){return A(Math.sin(Math.PI*2*i.waveOffset*-1+Math.PI*2*(1-i.waveCount)+e.y*2*Math.PI))}).y1(function(e){return y*2+b}),j=D.append("defs").append("clipPath").attr("id","clipWave"+n),F=j.append("path").datum(T).attr("d",B),I=D.append("g").attr("clip-path","url(#clipWave"+n+")");I.append("circle").attr("cx",o).attr("cy",o).attr("r",y).style("fill",i.waveColor);var q=I.append("text").text(x(p)+d).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size",c+"px").style("fill",i.waveTextColor).attr("transform","translate("+o+","+_(i.textVertPosition)+")");if(i.valueCountUp){var R=function(){var t=e.interpolate(this.textContent,h);return function(e){this.textContent=x(t(e))+d}};H.transition().duration(i.waveRiseTime).tween("text",R),q.transition().duration(i.waveRiseTime).tween("text",R)}var U=g+y*2-S;i.waveRise?j.attr("transform","translate("+U+","+O(0)+")").transition().duration(i.waveRiseTime).attr("transform","translate("+U+","+O(f)+")").each("start",function(){F.attr("transform","translate(1,0)")}):j.attr("transform","translate("+U+","+O(f)+")"),i.waveAnimate&&z()}return{liquidFillGaugeDefaultSettings:t,loadLiquidFillGauge:n}});
