var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define(["underscore","jquery","when","core/plugin/routing/assets/appRouterController","core/util/navigation/navigate","core/util/dictionary/getDictionaryData"],function(e,t,n,r,i,s){var o;return o=function(){function s(){this.extendStrategyWithDocumentHint=__bind(this.extendStrategyWithDocumentHint,this),this.successHandler=__bind(this.successHandler,this),this.checkBonusCardReady=__bind(this.checkBonusCardReady,this)}return s.prototype.onInit=function(){return this.bonusCardToggler=t("#bonusCard",this.passengerFormView),this.genderInput=t("[name=gender]",this.passengerFormView),this.validUntilInput=t("[name=validUntil]",this.passengerFormView),this.citizenshipSelect=t("[name=citizenship]",this.passengerFormView),this.documentInput=t("[name=document]",this.passengerFormView),this.bonusCardAircompany=t("[name=airCompany]",this.passengerFormView),this.bonusCardNumber=t("[name=bonusCardNumber]",this.passengerFormView),this.personId=e.last(r.getCurrentRoute().params),this.shiftBackSuccess=function(e){return function(){return i(e.baseOfferHash)}}(this)},s.prototype.onReady=function(){return e.defer(function(e){return function(){return n(e.validatorIsReady).then(function(){return e.arrangeValidationStrategyPart("validUntil","add")})}}(this)),this.onChangeCitizenshipSelect(),this.addBonusCardEvents()},s.prototype.addBonusCardEvents=function(){return this.bonusCardNumber.on("focus",function(e){return function(t){if(!t.target.value.length)return e.validator.extendStrategy(e.bonusCardStrategy)}}(this)).on("blur",function(e){return function(t){return n(e.validatorIsReady).then(function(){if(!t.target.value.length)return e.validator.removeStrategyField("airCompany"),e.validator.removeStrategyField("bonusCardNumber")})}}(this))},s.prototype.checkBonusCardReady=function(){if(this.bonusCardToggler.is(":checked"))if(this.bonusCardAircompany.attr("type")==="hidden"){if(this.bonusCardNumber.val().length)return this.addBonusCardInputsToValidator()}else if(this.bonusCardAircompany.val())return this.addBonusCardInputsToValidator()},s.prototype.addBonusCardInputsToValidator=function(){this.bonusCardAircompany.val()&&this.validator.addStrategyField(["airCompany"]);if(this.bonusCardNumber.val())return this.validator.addStrategyField(["bonusCardNumber"])},s.prototype.onSubmit=function(){return this.checkBonusCardReady(),!1},s.prototype.onChangeBonusCardNumber=function(e){return n(this.validatorIsReady).then(function(t){return function(){if(e.target.value.length)return t.validator.extendStrategy(t.bonusCardStrategy)}}(this))},s.prototype.successHandler=function(e){return this.personsCollection.update({id:this.personId},{formData:e}),this.shiftBackSuccess()},s.prototype.onRadioChecked=function(e){e.target.id==="male"&&(this.genderInput.val("male"),this.genderInput.trigger("input"));if(e.target.id==="female")return this.genderInput.val("female"),this.genderInput.trigger("input")},s.prototype.onChangeCitizenshipSelect=function(){var e,n;return e=this.citizenshipSelect.val(),n=this.documentInput.val(),e==="1"&&t.trim(n).length>0?this.triggerDocumentInputChange():this.restoreValidUntilInputAndStrategyPart()},s.prototype.triggerDocumentInputChange=function(){return this.documentInput.trigger("change")},s.prototype.blockValidUntilField=function(t){return e.defer(function(e){return function(){return t?(e.validUntilInput.val(""),e.validUntilInput.prop("disabled",!0),e.arrangeValidationStrategyPart("validUntil","remove")):e.restoreValidUntilInputAndStrategyPart()}}(this))},s.prototype.restoreValidUntilInputAndStrategyPart=function(){return this.validUntilInput.prop("disabled",!1),this.arrangeValidationStrategyPart("validUntil","add")},s.prototype.extendStrategyWithDocumentHint=function(t){return e.defer(function(e){return function(){return n(e.validatorIsReady).then(function(n){if(t.isHint)return n.extendStrategy({document:{hint:e.formatDocumentHint(t.resultTypesLocalized)}})})}}(this))},s.prototype.arrangeValidationStrategyPart=function(e,t){if(t==="remove")return this.validator.removeStrategyField(e);if(t==="add")return this.validator.extendStrategy(this[e+"Strategy"])},s.prototype.formatDocumentHint=function(t){var n;return n=[],n.push(t.shift()),e.each(t,function(e){return n.push(e.toLowerCase())}),n.join(" или ")},s}()});
