define(["underscore","when","when/pipeline","./tasksFactory","core/util/navigation/navigate"],function(e,t,n,r,i){var s;return s=function(){function n(){var t;e.bindAll(this),t=["wireChildContext","checkForAccess","sequenceBehavior","synchronize"],this.tasksFactory=new r(this,t)}return n.prototype.parentContext=void 0,n.prototype.deliver=function(t,n){return this.parentContext=t,e.each(n,function(e){return function(t,n){return n===0&&(e.mainSpecification=t.spec),e.tasksFactory.runTasks(t)}}(this))},n.prototype.wireChildContext=function(e){var n,r;return n=this.contextController.getRegistredContext(e.route,"child"),n!=null?n:(r={__environmentVars:{spec:e.spec,replaceable:e.replaceable,route:e.route,destroyOnBlur:e.destroyOnBlur},slot:e.slot},typeof e.behavior!="undefined"&&(r.behavior=this.prepareBehavior(e.behavior)),t(this.environment.loadInEnvironment(e.spec,e.mergeWith,r,this.parentContext)).then(function(t){return function(n){return e.noCache||t.contextController.register(t.parentContext,n,e),e.clearCache&&t.contextController.clearCache(),n}}(this),function(e){return console.debug("ChildContextProcessor::wireChildContext:rejectReason:",e)}))},n.prototype.checkForAccess=function(e){var t;return t=this.accessPolicyProcessor.askForAccess(e),t?e:{}},n.prototype.sequenceBehavior=function(e){return e.behavior!=null&&e.__environmentVars.spec===this.mainSpecification?this.behaviorProcessor.sequenceBehavior(e):e},n.prototype.synchronize=function(e){return typeof e.synchronizeWithRoute!="undefined"&&e.synchronizeWithRoute.call(e),e},n}()});
