define(["underscore","jquery","meld","wire/lib/object","kefir","kefirJquery","eventEmitter"],function(e,t,n,r,i,s,o){return s.init(i,t),function(s){var u,a,f,l,c,h,p;return h=[],l=function(e){return e&&r.hasOwn(e,"$ref")},f=function(e){return e.split(".").slice(0,2)},u=function(e,t,r){var s,u,a,c;if(!l(e))throw new Error("Should be described as wire reference!");return c=f(e.$ref),u=c[0],s=c[1],a={provider:{$ref:u},method:e},r(a).then(function(e){var r;return e.provider.emitter==null&&(e.provider.emitter=new o),r=s+"Event",t.push(i.fromEvent(e.provider.emitter,r)),h.push(n.after(e.provider,s,function(t){return e.provider.emitter.emit(r,t)}))})},a=function(t,n){var r;return r=[],e.each(t,function(e){return u(e,r,n)}),r},p=function(n,r,s){var o,u,f;return o=[],f=r.target,u=a(r.options.byInvocations,s),s(r.options).then(function(r){var s,a,l;s=r.deliverTo;if(e.isPlainObject(s))a=function(t){return s=e.extend(s,t)};else{if(!e.isFunction(s))throw new Error("Option 'deliverTo' should be function or plain js object!");a=s}return l=t(f),e.each(r.byFields,function(e){var t;return o[e]=l.find("[name='"+e+"']"),t=function(e){return function(){var t;return t={name:e,value:o[e].val()},t}}(e),u[e]=o[e].asKefirStream("change",t)}),i.combine(e.values(u)).onValue(a),n.resolve()})},c={facets:{valuesBunch:{ready:p}}},c}});
